<article
  class="group relative overflow-hidden rounded-xl bg-slate-800 shadow-lg 
         hover:shadow-2xl hover:shadow-blue-500/20 transition-all duration-300 ease-in-out
         transform hover:-translate-y-1 cursor-pointer border border-slate-700 hover:border-blue-500/50"
  (click)="openInGiphy()"
  role="button"
  tabindex="0"
  [attr.aria-label]="'Ver ' + gifTitle + ' en Giphy'"
  (keydown.enter)="openInGiphy()"
  (keydown.space)="openInGiphy()"
>
  <div class="relative w-full aspect-square overflow-hidden bg-slate-900">
    
    <!-- Estado de carga -->
    @if (!imageError()) {
      <div class="absolute inset-0 animate-pulse bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800"></div>
    }

    <!-- Imagen del GIF con manejo de errores -->
    <img
      [src]="imageUrl"
      [alt]="altText"
      [title]="gifTitle"
      (error)="onImageError()"
      class="w-full h-full object-cover transition-transform duration-300 
             group-hover:scale-110 relative z-10"
      loading="lazy"
      decoding="async"
    />

    <!-- Indicador de error visible -->
    @if (imageError()) {
      <div class="absolute inset-0 flex items-center justify-center bg-slate-900 z-20">
        <div class="text-center p-4">
          <svg class="w-12 h-12 mx-auto text-slate-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
          <p class="text-xs text-slate-500">Imagen no disponible</p>
        </div>
      </div>
    }

    <!-- hover -->
    <div
      class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent
             opacity-0 group-hover:opacity-100 transition-opacity duration-300
             flex flex-col justify-between p-3 sm:p-4 z-30"
      aria-hidden="true"
    >
      <!-- Icono de enlace externo -->
      <div class="flex justify-end">
        <div class="bg-white/90 backdrop-blur-sm rounded-full p-2">
          <svg class="w-4 h-4 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
          </svg>
        </div>
      </div>

      <!-- Usuario que lo creo -->
      @if (username !== 'An√≥nimo') {
        <div
          class="flex items-center gap-1.5 bg-white/95 backdrop-blur-sm 
                 rounded-full px-3 py-1.5 text-xs sm:text-sm self-start max-w-[80%]"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-blue-600 flex-shrink-0"
            aria-hidden="true"
          >
            <path
              d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z"
            />
          </svg>
          <span class="font-semibold text-gray-800 truncate">
            {{ username }}
          </span>
        </div>
      }
    </div>
  </div>

  <!-- Informacion del GIF -->
  <div class="p-3 sm:p-4 bg-slate-800">
    <!-- Titulo -->
    <h3
      class="text-sm sm:text-base font-semibold text-white 
             line-clamp-2 leading-snug min-h-[2.5rem] sm:min-h-[3rem] mb-2"
      [title]="gifTitle"
    >
      {{ gifTitle }}
    </h3>

    <div class="flex items-center justify-between gap-2 mt-2">

      <span class="text-xs text-slate-500 ml-auto" aria-label="Powered by Giphy">
        via GIPHY
      </span>
    </div>
  </div>

  <div class="absolute inset-0 rounded-xl ring-2 ring-blue-500 ring-offset-2 ring-offset-slate-950 opacity-0 focus-within:opacity-100 pointer-events-none transition-opacity"></div>
</article>
